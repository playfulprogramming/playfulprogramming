---
import * as fs from "fs/promises";
import Document from "src/layouts/document.astro";
import SEO from "components/seo/seo.astro";
import AboutView from "src/views/about/about.astro";
import { getLanguageFromFilename, translate } from "utils/translations";
import { join } from "path";
import { contentDirectory } from "utils/data";
import { Languages } from "types/index";

const params = Astro.params as {
	locale: Languages;
};

const locale = params.locale && params.locale !== "en" ? params.locale : "en";

const siteFiles = await fs.readdir(join(contentDirectory, "site"));

let locales = [] as Languages[];
let file = null;

for (const siteFileName of siteFiles) {
	if (!siteFileName.startsWith("about-us")) continue;
	const fileLocale = getLanguageFromFilename(siteFileName);
	locales.push(fileLocale);
	if (fileLocale !== locale) continue;
	file = join(contentDirectory, "site", siteFileName);
}

if (!file) {
	return Astro.redirect("/404");
}
---

<Document>
	<SEO
		title={translate(Astro, "title.about_us")}
		description={translate(Astro, "desc.about_us")}
		providedLangs={locales}
		slot="head"
	/>
	<AboutView locales={locales} locale={locale} file={file} />
</Document>
